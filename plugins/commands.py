import os
from config import Config
from .fonts import Fonts
from pyrogram import Client, filters
from pyrogram.types import InlineKeyboardButton, InlineKeyboardMarkup


# Define a dictionary to track user states
user_states = {}

# Define a start command handler
@Client.on_message(filters.command('start'))
async def start(c, m):
    owner = await c.get_users(int(Config.OWNER_ID))
    owner_username = owner.username if owner.username else 'GenXNano'
    # Your start command handler code here
    text = f"Welcome to the Bot, {m.from_user.mention(style='md')}!\n\nI can help you with fonts. Just send me some text."
    buttons = [
        [
            InlineKeyboardButton("â— Sá´œá´˜á´˜á´Ê€á´› â—", url="https://telegram.me/GenXNano"),
        ],
        [
            InlineKeyboardButton("â— Há´‡ÊŸá´˜ â—", callback_data="help"),
        ]
    ]
    await m.reply_text(text=text, reply_markup=InlineKeyboardMarkup(buttons))

# Define a callback query handler
@Client.on_callback_query()
async def callback_query_handler(client, callback_query):
    user_id = callback_query.from_user.id
    data = callback_query.data   

    if data == "help":
        # Handle the "help" button callback
        help_text = "**ğŸŒŸ Welcome to the Campus Font Bot! ğŸŒŸ**\n\nLooking to spice up your text messages with some unique fonts? You're in the right place! Our bot can transform your plain text into cool and eye-catching fonts. It's super easy to use!\n\n**ğŸ“ How to Use:**\n\n1. Start a chat with this bot.\n2. Simply send the text you want to convert into cool fonts as a message.\n3. Wait for the magic to happen! The bot will send your text back in a variety of cool fonts.\n4. Copy the font you like and paste it into your chats, captions, or wherever you want to impress your friends.\n\nFeel free to send as many messages as you like. Experiment and have fun!"
        back_button = InlineKeyboardButton("â— Bá´€á´„á´‹ â—", callback_data="back_help")
        keyboard = InlineKeyboardMarkup(inline_keyboard=[[back_button]])
        await callback_query.message.edit_text(text=help_text, reply_markup=keyboard)
        user_states[user_id] = "help"

    elif data == "back_help":
        # Handle the "Back" button from the Help menu
        start_text = "Welcome to the Bot!\n\nI can help you with fonts. Just send me some text."
        buttons = [
            [
                InlineKeyboardButton("â— Sá´œá´˜á´˜á´Ê€á´› â—", url="https://telegram.me/GenXNano"),
            ],
            [
                InlineKeyboardButton("â— Há´‡ÊŸá´˜ â—", callback_data="help"),
            ]
        ]
        await callback_query.message.edit_text(text=start_text, reply_markup=InlineKeyboardMarkup(buttons))
        user_states[user_id] = "start"

@Client.on_message(filters.private & filters.incoming & filters.text)
async def style_buttons(c, m, cb=False):
    buttons = [[
        InlineKeyboardButton('ğšƒğš¢ğš™ğšğš ğš›ğš’ğšğšğš›', callback_data='style+typewriter'),
        InlineKeyboardButton('ğ•†ğ•¦ğ•¥ğ•ğ•šğ•Ÿğ•–', callback_data='style+outline'),
        InlineKeyboardButton('ğ’ğğ«ğ¢ğŸ', callback_data='style+serif'),
        ],[
        InlineKeyboardButton('ğ‘ºğ’†ğ’“ğ’Šğ’‡', callback_data='style+bold_cool'),
        InlineKeyboardButton('ğ‘†ğ‘’ğ‘Ÿğ‘–ğ‘“', callback_data='style+cool'),
        InlineKeyboardButton('Sá´á´€ÊŸÊŸ Cá´€á´˜s', callback_data='style+small_cap'),
        ],[
        InlineKeyboardButton('ğ“ˆğ’¸ğ“‡ğ’¾ğ“…ğ“‰', callback_data='style+script'),
        InlineKeyboardButton('ğ“¼ğ“¬ğ“»ğ“²ğ“¹ğ“½', callback_data='style+script_bolt'),
        InlineKeyboardButton('áµ—â±â¿Ê¸', callback_data='style+tiny'),
        ],[
        InlineKeyboardButton('á‘•Oá—°Iá‘•', callback_data='style+comic'),
        InlineKeyboardButton('ğ—¦ğ—®ğ—»ğ˜€', callback_data='style+sans'),
        InlineKeyboardButton('ğ™ğ™–ğ™£ğ™¨', callback_data='style+slant_sans'),
        ],[
        InlineKeyboardButton('ğ˜šğ˜¢ğ˜¯ğ˜´', callback_data='style+slant'),
        InlineKeyboardButton('ğ–²ğ–ºğ—‡ğ—Œ', callback_data='style+sim'),
         InlineKeyboardButton('â’¸ï¸â’¾ï¸â“‡ï¸â’¸ï¸â“ï¸â’ºï¸â“ˆï¸', callback_data='style+circles'),
        ],[
        InlineKeyboardButton('ğŸ…’ï¸ğŸ…˜ï¸ğŸ…¡ï¸ğŸ…’ï¸ğŸ…›ï¸ğŸ…”ï¸ğŸ…¢ï¸', callback_data='style+circle_dark'),
        InlineKeyboardButton('ğ”Šğ”¬ğ”±ğ”¥ğ”¦ğ” ', callback_data='style+gothic'),
        InlineKeyboardButton('ğ•²ğ–”ğ–™ğ–ğ–ğ–ˆ', callback_data='style+gothic_bolt'),
        ],[
        InlineKeyboardButton('CÍ¡ÍœlÍ¡ÍœoÍ¡ÍœuÍ¡ÍœdÍ¡ÍœsÍ¡Íœ', callback_data='style+cloud'),
        InlineKeyboardButton('HÌ†ÌˆaÌ†ÌˆpÌ†ÌˆpÌ†ÌˆyÌ†Ìˆ', callback_data='style+happy'),
        InlineKeyboardButton('SÌ‘ÌˆaÌ‘ÌˆdÌ‘Ìˆ', callback_data='style+sad'),
        ],[
        InlineKeyboardButton('Next â¡ï¸', callback_data="nxt")
    ]]
    if not cb:
        await m.reply_text(m.text, reply_markup=InlineKeyboardMarkup(buttons), quote=True)
    else:
        await m.answer()
        await m.message.edit_reply_markup(InlineKeyboardMarkup(buttons))


@Client.on_callback_query(filters.regex('^nxt'))
async def nxt(c, m):
    if m.data == "nxt":
        buttons = [[
            InlineKeyboardButton('ğŸ‡¸â€ŠğŸ‡µâ€ŠğŸ‡ªâ€ŠğŸ‡¨â€ŠğŸ‡®â€ŠğŸ‡¦â€ŠğŸ‡±â€Š', callback_data='style+special'),
            InlineKeyboardButton('ğŸ…‚ğŸ…€ğŸ…„ğŸ„°ğŸ…ğŸ„´ğŸ…‚', callback_data='style+squares'),
            InlineKeyboardButton('ğŸ†‚ï¸ğŸ†€ï¸ğŸ†„ï¸ğŸ…°ï¸ğŸ†ï¸ğŸ…´ï¸ğŸ†‚ï¸', callback_data='style+squares_bold'),
            ],[
            InlineKeyboardButton('êª–êª€á¦”êª–êª¶êªŠá¥´ğ“²êª–', callback_data='style+andalucia'),
            InlineKeyboardButton('çˆªå‚å‡ á˜œå‚', callback_data='style+manga'),
            InlineKeyboardButton('SÌ¾tÌ¾iÌ¾nÌ¾kÌ¾yÌ¾', callback_data='style+stinky'),
            ],[
            InlineKeyboardButton('BÍ¦Ì¥uÍ¦Ì¥bÍ¦Ì¥bÍ¦Ì¥lÍ¦Ì¥eÍ¦Ì¥sÍ¦Ì¥', callback_data='style+bubbles'),
            InlineKeyboardButton('UÍŸnÍŸdÍŸeÍŸrÍŸlÍŸiÍŸnÍŸeÍŸ', callback_data='style+underline'),
            InlineKeyboardButton('ê’’êê€·êŒ©êŒƒê€ê…', callback_data='style+ladybug'),
            ],[
            InlineKeyboardButton('RÒ‰aÒ‰yÒ‰sÒ‰', callback_data='style+rays'),
            InlineKeyboardButton('BÒˆiÒˆrÒˆdÒˆsÒˆ', callback_data='style+birds'),
            InlineKeyboardButton('SÌ¸lÌ¸aÌ¸sÌ¸hÌ¸', callback_data='style+slash'),
            ],[
            InlineKeyboardButton('sâƒ tâƒ oâƒ pâƒ ', callback_data='style+stop'),
            InlineKeyboardButton('SÍ†ÌºkÍ†ÌºyÍ†ÌºlÍ†ÌºiÍ†ÌºnÍ†ÌºeÍ†Ìº', callback_data='style+skyline'),
            InlineKeyboardButton('AÍrÍrÍoÍwÍsÍ', callback_data='style+arrows'),
            ],[
            InlineKeyboardButton('á‹ªáˆ€áŠ­á‰¿áŠ', callback_data='style+qvnes'),
            InlineKeyboardButton('SÌ¶tÌ¶rÌ¶iÌ¶kÌ¶eÌ¶', callback_data='style+strike'),
            InlineKeyboardButton('Fà¼™rà¼™oà¼™zà¼™eà¼™nà¼™', callback_data='style+frozen')
            ],[
            InlineKeyboardButton('â¬…ï¸ Back', callback_data='nxt+0')
        ]]
        await m.answer()
        await m.message.edit_reply_markup(InlineKeyboardMarkup(buttons))
    else:
        await style_buttons(c, m, cb=True)


@Client.on_callback_query(filters.regex('^style'))
async def style(c, m):
    await m.answer()
    cmd, style = m.data.split('+')

    if style == 'typewriter':
        cls = Fonts.typewriter
    if style == 'outline':
        cls = Fonts.outline
    if style == 'serif':
        cls = Fonts.serief
    if style == 'bold_cool':
        cls = Fonts.bold_cool
    if style == 'cool':
        cls = Fonts.cool
    if style == 'small_cap':
        cls = Fonts.smallcap
    if style == 'script':
        cls = Fonts.script
    if style == 'script_bolt':
        cls = Fonts.bold_script
    if style == 'tiny':
        cls = Fonts.tiny
    if style == 'comic':
        cls = Fonts.comic
    if style == 'sans':
        cls = Fonts.san
    if style == 'slant_sans':
        cls = Fonts.slant_san
    if style == 'slant':
        cls = Fonts.slant
    if style == 'sim':
        cls = Fonts.sim
    if style == 'circles':
        cls = Fonts.circles
    if style == 'circle_dark':
        cls = Fonts.dark_circle
    if style == 'gothic':
        cls = Fonts.gothic
    if style == 'gothic_bolt':
        cls = Fonts.bold_gothic
    if style == 'cloud':
        cls = Fonts.cloud
    if style == 'happy':
        cls = Fonts.happy
    if style == 'sad':
        cls = Fonts.sad
    if style == 'special':
        cls = Fonts.special
    if style == 'squares':
        cls = Fonts.square
    if style == 'squares_bold':
        cls = Fonts.dark_square
    if style == 'andalucia':
        cls = Fonts.andalucia
    if style == 'manga':
        cls = Fonts.manga
    if style == 'stinky':
        cls = Fonts.stinky
    if style == 'bubbles':
        cls = Fonts.bubbles
    if style == 'underline':
        cls = Fonts.underline
    if style == 'ladybug':
        cls = Fonts.ladybug
    if style == 'rays':
        cls = Fonts.rays
    if style == 'birds':
        cls = Fonts.birds
    if style == 'slash':
        cls = Fonts.slash
    if style == 'stop':
        cls = Fonts.stop
    if style == 'skyline':
        cls = Fonts.skyline
    if style == 'arrows':
        cls = Fonts.arrows
    if style == 'qvnes':
        cls = Fonts.rvnes
    if style == 'strike':
        cls = Fonts.strike
    if style == 'frozen':
        cls = Fonts.frozen
    new_text = cls(m.message.reply_to_message.text)
    try:
        await m.message.edit_text(new_text, reply_markup=m.message.reply_markup)
    except Exception as e:
            print(f"Error editing text: {str(e)}")
